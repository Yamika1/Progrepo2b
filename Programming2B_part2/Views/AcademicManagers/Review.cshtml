@model Programming2B_part2.Models.Claims

@{
    ViewBag.Title = "Review";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<nav class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="/Lecturer">My claims</a></li>
        <li class="breadcrumb-item">Review</li>
    </ol>
</nav>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger"> @TempData["Error"]</div>
}

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex">
          
                <div>
                    @if (Model.Status == Programming2B_part2.Models.ClaimStatus.Pending)
                    {
                        <span class="badge bg-warning fs-6"> Pending Review</span>
                    }
                    else if (Model.Status == Programming2B_part2.Models.ClaimStatus.Approved)
                    {
                        <span class="badge bg-success fs-6">Approved</span>
                    }
                    else
                    {
                        <span class="badge bg-danger fs-6"> Declined</span>
                    }
                </div>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Claim Name</strong></div>
                    <div class="col-sm-9">@Model.ClaimName</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Claim Type</strong></div>
                    <div class="col-sm-9">@Model.ClaimType</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Hours Worked</strong></div>
                    <div class="col-sm-9">@Model.HoursWorked</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Hourly Rate</strong></div>
                    <div class="col-sm-9">
                        @Model.HourlyRate
                    </div>
                </div>
                <div"row mb-3">
                    <div class="col-sm-3"><strong>Submitted</strong></div>
                    <div class="col-sm-9">@Model.SubmittedDate.ToString("MM-dd-yyyy")</div>
            </div>
        </div>
    </div>
</div>
<div class="col-lg-4">
    <div class="card">
        <div class="card-header">
            @if (Model.Status == Programming2B_part2.Models.ClaimStatus.Pending)
            {
                <hr class="my-4">
                <h5>Submit Your Review</h5>

                <form asp-action="Approve" method="post" class="mb-3">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.ClaimId" />

                   

                    <button type="submit" class="btn btn-success btn-lg">
                        Approve 
                    </button>
                </form>

                <form asp-action="Decline" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.ClaimId" />

                    <div class="mb-3">
                        <label class="form-label">Reason for Declining *</label>
                        <textarea name="comments" class="form-control" rows="3" placeholder="Please provide detailed reasons for declining..." required></textarea>
                        
                    </div>

                    <button type="submit" class="btn btn-danger btn-lg">
                        Decline 
                    </button>
                    <a href="/AcademicManagers" class="btn btn-secondary btn-lg">Cancel</a>
                </form>
            }
        </div>
    </div>
    <></>
</div>


<div class="card mb-4">
    <div class="card-header">
        <h5>Supporting Documents (@Model?.Documents?.Count ?? 0)</h5>
    </div>
    <div class="card-body">
        @if (Model?.Documents == null || !Model.Documents.Any())
        {
            <p class="text-muted">No documents uploaded.</p>
        }
        else
        {
            <div class="list-group">
                @foreach (var doc in Model.Documents)
                {
                    <div class="list-group-item d-flex flex-column">
                        <strong>@doc.FileName</strong>
                        <span class="badge bg-success"> Encrypted</span>
                        <small>@(doc.FileSize / 1024) KB</small>
                        <a asp-controller="LecturerController"
                           asp-action="DownloadDocument"
                           asp-route-claimId="@Model.ClaimId"
                           asp-route-docId="@doc.Id"
                           class="btn btn-sm btn-primary mt-2">
                            Download & Decrypt
                        </a>
                    </div>
                }
            </div>
        }
    </div>
</div>